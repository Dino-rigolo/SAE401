RewriteEngine On
RewriteBase /SAE401/

# Autoriser l'accès direct aux fichiers statiques
RewriteCond %{REQUEST_URI} \.(css|js|jpg|jpeg|png|gif|ico)$ [OR]
RewriteCond %{REQUEST_URI} ^/SAE401/www/
RewriteRule .* - [L]

# Placer cette règle avant les règles API
RewriteRule ^shop/([0-9]+)/?$ index.php?action=shop&id=$1 [QSA,L]

# Ensuite les règles API
# Routes pour les marques (Brands)
# GET - Récupérer toutes les marques
RewriteRule ^api/brands/?$ api/ApiBrands.php?action=getall [L,QSA]

# GET - Récupérer une marque par ID
RewriteRule ^api/brands/([0-9]+)/?$ api/ApiBrands.php?action=getbyid&id=$1 [L,QSA]

# POST - Créer une nouvelle marque
RewriteCond %{REQUEST_METHOD} POST
RewriteRule ^api/brands/?$ api/ApiBrands.php?action=create [L,QSA]

# PUT - Mettre à jour une marque
RewriteCond %{REQUEST_METHOD} PUT
RewriteRule ^api/brands/([0-9]+)/?$ api/ApiBrands.php?action=update&id=$1 [L,QSA]

# DELETE - Supprimer une marque
RewriteCond %{REQUEST_METHOD} DELETE
RewriteRule ^api/brands/([0-9]+)/?$ api/ApiBrands.php?action=delete&id=$1 [L,QSA]

# Routes pour les catégories (Categories)
# GET - Récupérer toutes les catégories
RewriteRule ^api/categories/?$ api/ApiCategories.php?action=getall [L,QSA]

# GET - Récupérer une catégorie par ID
RewriteRule ^api/categories/([0-9]+)/?$ api/ApiCategories.php?action=getbyid&id=$1 [L,QSA]

# POST - Créer une nouvelle catégorie
RewriteCond %{REQUEST_METHOD} POST
RewriteRule ^api/categories/?$ api/ApiCategories.php?action=create [L,QSA]

# PUT - Mettre à jour une catégorie
RewriteCond %{REQUEST_METHOD} PUT
RewriteRule ^api/categories/([0-9]+)/?$ api/ApiCategories.php?action=update&id=$1 [L,QSA]

# DELETE - Supprimer une catégorie
RewriteCond %{REQUEST_METHOD} DELETE
RewriteRule ^api/categories/([0-9]+)/?$ api/ApiCategories.php?action=delete&id=$1 [L,QSA]

# Routes pour les employés (Employees)
# GET - Récupérer tous les employés
RewriteRule ^api/employees/?$ api/ApiEmployees.php?action=getall [L,QSA]

# GET - Récupérer un employé par ID
RewriteRule ^api/employees/([0-9]+)/?$ api/ApiEmployees.php?action=getbyid&id=$1 [L,QSA]

# GET - Récupérer un employé par email
RewriteRule ^api/employees/email/([^/]+)/?$ api/ApiEmployees.php?action=getbyemail&email=$1 [L,QSA]

# POST - Créer un nouvel employé
RewriteCond %{REQUEST_METHOD} POST
RewriteRule ^api/employees/?$ api/ApiEmployees.php?action=create [L,QSA]

# PUT - Mettre à jour un employé
RewriteCond %{REQUEST_METHOD} PUT
RewriteRule ^api/employees/([0-9]+)/?$ api/ApiEmployees.php?action=update&id=$1 [L,QSA]

# DELETE - Supprimer un employé
RewriteCond %{REQUEST_METHOD} DELETE
RewriteRule ^api/employees/([0-9]+)/?$ api/ApiEmployees.php?action=delete&id=$1 [L,QSA]

# Routes pour les produits (Products)
# GET - Récupérer tous les produits
RewriteRule ^api/products/?$ api/ApiProducts.php?action=getall [L,QSA]

# GET - Récupérer un produit par ID
RewriteRule ^api/products/([0-9]+)/?$ api/ApiProducts.php?action=getbyid&id=$1 [L,QSA]

# POST - Créer un nouveau produit
RewriteCond %{REQUEST_METHOD} POST
RewriteRule ^api/products/?$ api/ApiProducts.php?action=create [L,QSA]

# PUT - Mettre à jour un produit
RewriteCond %{REQUEST_METHOD} PUT
RewriteRule ^api/products/([0-9]+)/?$ api/ApiProducts.php?action=update&id=$1 [L,QSA]

# DELETE - Supprimer un produit
RewriteCond %{REQUEST_METHOD} DELETE
RewriteRule ^api/products/([0-9]+)/?$ api/ApiProducts.php?action=delete&id=$1 [L,QSA]

# Routes pour les stocks (Stocks)
# GET - Récupérer tous les stocks
RewriteRule ^api/stocks/?$ api/ApiStocks.php?action=getall [L,QSA]

# GET - Récupérer un stock par ID
RewriteRule ^api/stocks/([0-9]+)/?$ api/ApiStocks.php?action=getbyid&id=$1 [L,QSA]

# POST - Créer un nouveau stock
RewriteCond %{REQUEST_METHOD} POST
RewriteRule ^api/stocks/?$ api/ApiStocks.php?action=create [L,QSA]

# PUT - Mettre à jour un stock
RewriteCond %{REQUEST_METHOD} PUT
RewriteRule ^api/stocks/([0-9]+)/?$ api/ApiStocks.php?action=update&id=$1 [L,QSA]

# DELETE - Supprimer un stock
RewriteCond %{REQUEST_METHOD} DELETE
RewriteRule ^api/stocks/([0-9]+)/?$ api/ApiStocks.php?action=delete&id=$1 [L,QSA]

# Routes pour les magasins (Stores)
# GET - Récupérer tous les magasins
RewriteRule ^api/stores/?$ api/ApiStores.php?action=getall [L,QSA]

# GET - Récupérer un magasin par ID
RewriteRule ^api/stores/([0-9]+)/?$ api/ApiStores.php?action=getbyid&id=$1 [L,QSA]

# POST - Créer un nouveau magasin
RewriteCond %{REQUEST_METHOD} POST
RewriteRule ^api/stores/?$ api/ApiStores.php?action=create [L,QSA]

# PUT - Mettre à jour un magasin
RewriteCond %{REQUEST_METHOD} PUT
RewriteRule ^api/stores/([0-9]+)/?$ api/ApiStores.php?action=update&id=$1 [L,QSA]

# DELETE - Supprimer un magasin
RewriteCond %{REQUEST_METHOD} DELETE
RewriteRule ^api/stores/([0-9]+)/?$ api/ApiStores.php?action=delete&id=$1 [L,QSA]

# Règle générale pour les actions add
RewriteRule ^addbrands/?$ controller/index.php?action=addbrands [L,QSA]
RewriteRule ^addcategories/?$ controller/index.php?action=addcategories [L,QSA]
RewriteRule ^addshops/?$ controller/index.php?action=addshops [L,QSA]
RewriteRule ^addproducts/?$ controller/index.php?action=addproducts [L,QSA]
RewriteRule ^addstocks/?$ controller/index.php?action=addstocks [L,QSA]

# Routes pour les actions de modification
RewriteRule ^modifbrands/([0-9]+)/?$ controller/index.php?action=modifbrands&id=$1 [L,QSA]
RewriteRule ^modifcategories/([0-9]+)/?$ controller/index.php?action=modifcategories&id=$1 [L,QSA]
RewriteRule ^modifshops/([0-9]+)/?$ controller/index.php?action=modifshops&id=$1 [L,QSA]
RewriteRule ^modifproducts/([0-9]+)/?$ controller/index.php?action=modifproducts&id=$1 [L,QSA]
RewriteRule ^modifstocks/([0-9]+)/?$ controller/index.php?action=modifstocks&id=$1 [L,QSA]
RewriteRule ^modifemployees/([0-9]+)/?$ controller/index.php?action=modifemployees&id=$1 [L,QSA]

# Routes pour les actions de mise à jour
RewriteRule ^updatebrands/?$ controller/index.php?action=updatebrands [L,QSA]
RewriteRule ^updatecategories/?$ controller/index.php?action=updatecategories [L,QSA]
RewriteRule ^updateshops/?$ controller/index.php?action=updateshops [L,QSA]
RewriteRule ^updateproducts/?$ controller/index.php?action=updateproducts [L,QSA]
RewriteRule ^updatestocks/?$ controller/index.php?action=updatestocks [L,QSA]
RewriteRule ^updateemployees/?$ controller/index.php?action=updateemployees [L,QSA]

# Routes pour les actions de suppression
RewriteRule ^deletebrands/([0-9]+)/?$ controller/index.php?action=deletebrands&id=$1 [L,QSA]
RewriteRule ^deletecategories/([0-9]+)/?$ controller/index.php?action=deletecategories&id=$1 [L,QSA]
RewriteRule ^deleteshops/([0-9]+)/?$ controller/index.php?action=deleteshops&id=$1 [L,QSA]
RewriteRule ^deleteproducts/([0-9]+)/?$ controller/index.php?action=deleteproducts&id=$1 [L,QSA]
RewriteRule ^deletestocks/([0-9]+)/?$ controller/index.php?action=deletestocks&id=$1 [L,QSA]
RewriteRule ^deleteemployees/([0-9]+)/?$ controller/index.php?action=deleteemployees&id=$1 [L,QSA]

# Ou une règle plus générique
RewriteRule ^add([a-zA-Z]+)/?$ index.php?action=add$1 [L,QSA]

# Règle pour gérer les routes non-API (doit être en dernier)
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ index.php?action=$1 [QSA,L]

# Permettre CORS pour l'API
<IfModule mod_headers.c>
    <FilesMatch "^api/">
        Header Set Access-Control-Allow-Origin "*"
        Header Set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Header Set Access-Control-Allow-Headers "Content-Type, Authorization, Api"
    </FilesMatch>
</IfModule>